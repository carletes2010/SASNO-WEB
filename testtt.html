<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SASNO WEB</title>
<link rel="icon" href="assets/icon.png">
<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;700&display=swap" rel="stylesheet">
<script src="https://js.pusher.com/8.2/pusher.min.js"></script>

<style>
/* …── estilos base (igual que antes) … */
#btnCloseGlobal{
  position:fixed;top:16px;left:16px;
  width:48px;height:48px;font-size:2rem;
  border:none;border-radius:50%;background:#fff;color:#000;
  cursor:pointer;display:none;align-items:center;justify-content:center;
  z-index:10000;box-shadow:0 0 10px rgba(0,0,0,.45)
}
/* el resto de estilos: viewHome, viewConfig, viewAlert, popBox, advBox … */
</style>
</head>
<body>

<!--  botón X universal  -->
<button id="btnCloseGlobal">×</button>

<!-- ========= VISTA INICIO ========= -->
<section id="viewHome">
  <!-- … logo, estado … -->
</section>

<!-- ========= VISTA CONFIG ========= -->
<section id="viewConfig" style="display:none">
  <!-- … contenido configuración … -->
</section>

<!-- ========= OVERLAY ALERTA ========= -->
<section id="viewAlert" style="display:none">
  <img src="assets/whitelogo.png" style="height:60px">
  <h1 id="alertTitle">¡ALERTA SÍSMICA!</h1>
  <img src="assets/handicon.png" style="height:200px">
  <h2 id="alertSub">Mantén la calma</h2>
</section>

<!-- ========= POP & ADVISORY ========= -->
<div id="popBox"   style="display:none"><iframe id="popFrame"></iframe></div>
<div id="advBox"   style="display:none"><iframe id="advFrame"></iframe></div>

<audio id="alertAudio" src="assets/alertaudio.mp3" preload="auto"></audio>

<script>
document.addEventListener('DOMContentLoaded',()=>{

/* refs */
const $=id=>document.getElementById(id);
const btnX=$('btnCloseGlobal');
const viewAlert=$('viewAlert');
const advBox=$('advBox');
const popBox=$('popBox');
const popFrame=$('popFrame');
const advFrame=$('advFrame');
const chkMinor=$('chkMinor');      // en vista Config
/* helpers */
const showX =()=>{btnX.style.display='flex'};
const hideX =()=>{btnX.style.display='none'};
const closeAll=()=>{viewAlert.style.display='none';advBox.style.display='none';popBox.style.display='none';hideX();alertAudio.pause();};

/* botón X cierra lo que esté activo */
btnX.onclick=closeAll;

/* simulacro */
$('btnSimulacro').onclick=()=>{
  $('alertTitle').textContent='¡SIMULACRO!';
  $('alertSub').textContent='Prueba de alerta';
  viewAlert.style.display='flex';showX();alertAudio.play();
};

/* Pusher */
const pusher=new Pusher('0f74c31648d3adb34e1b',{cluster:'us2',forceTLS:true});
pusher.subscribe('alertas-sasno').bind('eqw',d=>{
  const {latitud,longitud,tipo}=d;
  if(tipo==='advisory'){
    if(!chkMinor.checked) return;
    closeAll();
    advFrame.src=`advisory.html?lat=${latitud}&lon=${longitud}`;
    advBox.style.display='block';showX();
    popFrame.src=`pop.html?lat=${latitud}&lon=${longitud}&modo=advisory`;
    popBox.style.display='block';
  }else{
    closeAll();
    $('alertTitle').textContent='¡ALERTA SÍSMICA!';
    $('alertSub').textContent='Mantén la calma';
    viewAlert.style.display='flex';showX();
    popFrame.src=`pop.html?lat=${latitud}&lon=${longitud}&modo=eqw`;
    popBox.style.display='block';alertAudio.play();
  }
});

/* cerrar advisory desde iframe */
window.addEventListener('message',e=>{if(e.data==='cerrarAdvisory') closeAll();});
});
</script>
</body>
</html>
